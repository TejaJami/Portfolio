SELECT first_name, last_name FROM actor WHERE first_name = 'Johnny';

/* What are the top/least rented(demanded) genres and what are what are their total sales? */
WITH t1 AS (SELECT c.name AS Genre, count(cu.customer_id) AS Total_rent_demand
            FROM category c
            JOIN film_category fc
            USING(category_id)
	    JOIN film f
            USING(film_id)
            JOIN inventory i
            USING(film_id)
            JOIN rental r
            USING(inventory_id)
            JOIN customer cu
            USING(customer_id)
            GROUP BY 1
            ORDER BY 2 DESC),
     t2 AS (SELECT c.name AS Genre, SUM(p.amount) AS total_sales
            FROM category c
            JOIN film_category fc
            USING(category_id)
            JOIN film f
            USING(film_id)
            JOIN inventory i
            USING(film_id)
            JOIN rental r
            USING(inventory_id)
            JOIN payment p
            USING(rental_id)
            GROUP BY 1
            ORDER BY 2 DESC)
SELECT t1.genre, t1.total_rent_demand, t2.total_sales
FROM t1
JOIN t2
ON t1.genre = t2.genre;

/* In which countries does Rent A Film have a presence in and what is the customer base in each country? What are the total sales in each country? (From most to least)*/
SELECT country, count(DISTINCT customer_id) AS customer_base, SUM(amount) AS total_sales
FROM country
JOIN city
USING(country_id)
JOIN address
USING(city_id)
JOIN customer
USING (address_id)
JOIN payment
USING(customer_id)
GROUP BY 1
ORDER BY 2 DESC;

/*Who are the top 5 customers per total sales and can we get their detail just in case Rent A Film want to reward them?*/
SELECT first_name || ' ' || last_name AS full_name, email, address, phone, city, country, sum(amount) AS total_purchase_in_currency
FROM customer
JOIN address USING(address_id)
JOIN city USING(city_id)
JOIN country using(country_id)
JOIN payment USING(customer_id)
GROUP BY 1,2,3,4,5,6
ORDER BY 7 DESC
LIMIT 5

/*What is the Average rental rate for each genre? (from the highest to the lowest)*/
SELECT c.name AS genre, ROUND(AVG(f.rental_rate),2) AS average_rental_rate
FROM category c JOIN film_category fc ON c.category_id=fc.category_id
JOIN film f on fc.film_id=f.film_id
GROUP BY genre
ORDER BY 2 DESC

/* Can we know how many distinct users have rented each genre?*/	
SELECT c.name AS genre, COUNT(DISTINCT(cu.customer_id)) AS Total_rental_demand
FROM category c JOIN film_category fc ON c.category_id=fc.category_id
JOIN film f on fc.film_id=f.film_id
JOIN inventory i  on f.film_id=i.film_id
JOIN rental r on i.inventory_id=r.inventory_id
JOIN customer cu on r.customer_id=cu.customer_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know total revenue generated by each genre?*/	
SELECT c.name AS genre, SUM(p.amount) AS Total_Revenue_generated
FROM category c JOIN film_category fc ON c.category_id=fc.category_id
JOIN film f ON fc.film_id=f.film_id
JOIN inventory i  ON f.film_id=i.film_id
JOIN rental r ON i.inventory_id=r.inventory_id
JOIN payment p ON r.rental_id=p.rental_id
GROUP BY 1
ORDER BY 2 DESC; 

/* Can we know the top 10 actors that generated the most revenue?*/	
SELECT a.first_name || ' ' || a.last_name AS full_name, SUM(p.amount) AS Total_Revenue_generated
FROM actor a JOIN film_actor fa ON a.actor_id=fa.actor_id
JOIN film f ON fa.film_id=f.film_id
JOIN inventory i ON f.film_id=i.film_id
JOIN rental r ON i.inventory_id=r.inventory_id
JOIN payment p ON r.rental_id=p.rental_id
GROUP BY 1 
ORDER BY 2 DESC
LIMIT 10;

/* Can we know the top 10 movies that generated the most revenue?*/	
SELECT f.title, SUM(p.amount) AS Total_Revenue_Generated 
FROM film f JOIN inventory i ON f.film_id=i.film_id
JOIN rental r ON i.inventory_id=r.inventory_id
JOIN payment p ON r.rental_id=p.rental_id
GROUP BY 1 
ORDER BY 2 DESC
LIMIT 10;

/* Can we know the total revenue generated by each country?*/	
SELECT c.country, ROUND(SUM(p.amount)) AS Total_Revenue_Generated,
SUM(round(SUM(p.amount), 2)) OVER (ORDER BY ROUND(SUM(amount), 2) DESC, c.country ) as Running_total
FROM country c JOIN city ci ON c.country_id=ci.country_id
JOIN address a ON ci.city_id=a.city_id
JOIN customer cu ON a.address_id=cu.address_id
JOIN payment p ON cu.customer_id=p.customer_id
GROUP BY 1
ORDER BY 2 DESC
LIMIT 10;

/* Can we know the number of rentals across each city?*/	
SELECT ci.city, co.country, COUNT(r.rental_id) AS No_of_Rentals
FROM country co JOIN city ci ON co.country_id=ci.country_id
JOIN address a ON ci.city_id=a.city_id
JOIN customer cu ON a.address_id=cu.address_id
JOIN rental r ON cu.customer_id=r.customer_id
GROUP BY 1,2
ORDER BY 3 DESC;

/* Can we know the total revenue generated by each city?*/	
SELECT ci.city, co.country, SUM(p.amount) AS Total_Revenue_Generated
FROM country co JOIN city ci ON co.country_id=ci.country_id
JOIN address a ON ci.city_id=a.city_id
JOIN customer cu ON a.address_id=cu.address_id
JOIN payment p ON cu.customer_id=p.customer_id
GROUP BY 1,2
ORDER BY 3 DESC;

/* Can we know the number of times each customer rented?*/	
SELECT cu.first_name || ' ' || cu.last_name AS full_name, COUNT(r.rental_id) AS No_of_Rentals
FROM customer cu JOIN rental r ON cu.customer_id=r.customer_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know the total amount spent by each customer?*/	
SELECT cu.first_name || ' ' || cu.last_name AS full_name,a.address,ci.city, a.district, a.postal_code,co.country ,SUM(p.amount) AS Total_Amount_Spent
FROM country co JOIN city ci ON co.country_id=ci.country_id
JOIN address a ON ci.city_id=a.city_id
JOIN customer cu ON a.address_id=cu.address_id
JOIN payment p ON cu.customer_id=p.customer_id
GROUP BY 1,2,3,4,5,6
ORDER BY 7 DESC;

/* Can we know the number of rentals across each country?*/	
SELECT co.country, COUNT(r.rental_id) AS No_of_Rentals
FROM country co JOIN city ci ON co.country_id=ci.country_id
JOIN address a ON ci.city_id=a.city_id
JOIN customer cu ON a.address_id=cu.address_id
JOIN rental r ON cu.customer_id=r.customer_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know the number of customers across each country?*/	
SELECT co.country, COUNT(DISTINCT(cu.customer_id)) AS No_of_Customers
FROM country co JOIN city ci ON co.country_id=ci.country_id
JOIN address a ON ci.city_id=a.city_id
JOIN customer cu ON a.address_id=cu.address_id
JOIN rental r ON cu.customer_id=r.customer_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know the number of times each staff member gave a movie for rent?*/	
SELECT s.first_name || ' ' || s.last_name AS full_name, COUNT(r.rental_id) AS No_of_Rentals
FROM staff s JOIN rental r ON s.staff_id=r.staff_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know the total amount collected by each staff member?*/	
SELECT s.first_name || ' ' || s.last_name AS full_name, SUM(p.amount) AS Total_Amount_Collected
FROM staff s JOIN payment p ON s.staff_id=p.staff_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know the total revenue generated by each movie?*/	
SELECT f.title, SUM(p.amount) AS Total_Revenue_Generated
FROM film f JOIN inventory i ON f.film_id=i.film_id
JOIN rental r ON i.inventory_id=r.inventory_id
JOIN payment p ON r.rental_id=p.rental_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know the number of times each movie rented?*/	
SELECT f.title, COUNT(r.rental_id) AS No_of_Rentals
FROM film f JOIN inventory i ON f.film_id=i.film_id
JOIN rental r ON i.inventory_id=r.inventory_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know total revenue generated per month?*/	
SELECT TO_CHAR(payment_date, 'Month') AS "Month", ROUND(SUM(amount),2) AS Revenue_per_Month
FROM payment
GROUP BY 1
ORDER BY 2 DESC;

SELECT TO_CHAR(rental_date, 'Month') AS "Month", COUNT(rental_id) AS Rentals_per_Month
FROM rental
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know total revenue generated per year?*/	
SELECT EXTRACT(YEAR FROM payment_date) AS Year, ROUND(SUM(amount),2) AS Revenue_per_Year
FROM payment
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know how many rentals per year?*/	
SELECT EXTRACT(YEAR FROM rental_date) AS Year, COUNT(rental_id) AS Rentals_per_Year
FROM rental
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know how many monthly unique renters?*/	
SELECT TO_CHAR(r.rental_date, 'Month') AS Month, COUNT(DISTINCT(c.customer_id)) AS Unique_renters_per_month
FROM rental r JOIN customer c ON r.customer_id=c.customer_id
GROUP BY 1
ORDER BY 2 DESC;

/* Can we know how many active customers?*/	
SELECT active, COUNT(customer_id) FROM customer
GROUP BY active
HAVING active=1;

